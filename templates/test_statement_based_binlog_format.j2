#!/usr/bin/env bats

{% import "macros.j2" as macros with context %}
{%- set global=manifest['global'] %}
{%- set replication=manifest['replication'] %}
{%- set pods=manifest['pods'] %}

{{ macros.import_common_functions() }}

@test '{{ test_name }}' {

{% for pod in pods %}
result=$(podman exec --env=MYSQL_PWD={{ global.user_root_pass }} {{ pods[0].containers[0].name }} mysql --user={{ global.user_root }} --host={{ pod.name }} --skip-column-names --execute 'SHOW VARIABLES LIKE "binlog_format"')
run grep --silent -E 'binlog_format.*STATEMENT' <<<"$result"
[ "$status" -eq 0 ]
{% endfor %}


}
